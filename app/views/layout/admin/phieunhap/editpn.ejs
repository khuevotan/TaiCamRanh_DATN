<div class="page-content fade-in-up">
    <div class="row">
        <div class="col-md-5"> 

            <% if (typeof status !== 'undefined') { %>
                <%if (status == 'success') { %>

                <div class="ibox ibox-success">
                    <div class="ibox-head">
                        <div class="ibox-title">
                            <div style="color: rgb(255, 255, 255);">
                                Cập Nhật Thành Công!
                            </div>
                        </div>
                        <div class="ibox-tools">
                            <a class="ibox-collapse"><i class="fa fa-minus"></i></a>
                            <a class="fullscreen-link"><i class="fa fa-expand"></i></a>
                        </div>

                <% } else { %>
                    <%if (status == 'error') { %>
                <div class=" ibox ibox-danger">
                    <div class="ibox-head">
                            <div class="ibox-title">
                              
                                    <div style="color: rgb(255, 255, 255);">
                                        Đã xảy ra lỗi khi cập nhật!
                                    </div>
                            </div>
                            <div class="ibox-tools">
                                    <a class="ibox-collapse"><i class="fa fa-minus"></i></a>
                                    <a class="fullscreen-link"><i class="fa fa-expand"></i></a>
                            </div>
                        <% } else { %>
                            <div class="ibox ibox-info">
                                <div class="ibox-head">
                                    <div class="ibox-title">
                                      
                                        <div style="color: rgb(255, 255, 255);">
                                          
                                        </div>
                                    </div>
                                    <div class="ibox-tools">
                                        <a class="ibox-collapse"><i class="fa fa-minus"></i></a>
                                        <a class="fullscreen-link"><i class="fa fa-expand"></i></a>
                                    </div>
                            <% } %>
                <% } %>
            <% } else { %>
            <div class="ibox ibox-info">
                <div class="ibox-head">
                    <div class="ibox-title">
                        <div style="color: rgb(255, 255, 255);">
                            Chỉnh Sửa Thông Tin
                        </div>
                    </div>
                    <div class="ibox-tools">
                        <a class="ibox-collapse"><i class="fa fa-minus"></i></a>
                        <a class="fullscreen-link"><i class="fa fa-expand"></i></a>
                    </div>
            <% } %>
                </div>

                <div class="ibox-body">
                    <form action="/admin/phieunhap/<%= phieunhap.mapn %>" class="form-horizontal"
                        id="form-sample-1" method="post" novalidate="novalidate"
                        onSubmit="return confirm('Bạn có chắc chắn muốn thay đổi thông tin?') "
                        >
                        <input type="hidden" name="_method" value="put" />
                        
                        <div class="form-group row">
                            <label class="col-sm-2 col-form-label">Mã Phiếu</label>
                            <div class="col-sm-10">
                                <input class="form-control" type="text" name="mapn"
                                    value="<%= phieunhap.mapn %>" readonly>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-sm-2 col-form-label">Ghi Chú</label>
                            <div class="col-sm-10">
                                <textarea class="form-control" rows="6"
                                    name="ghichu"><%= phieunhap.ghichu %></textarea>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-sm-2 col-form-label">Tổng tiền</label>
                            <div class="col-sm-10">
                                    <input class="form-control" type="text" name="tongtiennhap"
                                    value="<%= phieunhap.tongtiennhap %> VNĐ" readonly> 
                            </div>
                        </div>

              

                        <div class="form-group row">
                            <label class="col-sm-2 col-form-label">Thanh Toán</label>
                            <div class="col-sm-10">

                                <select class="form-control" name="thanhtoan">
                                        <% if(phieunhap.thanhtoan == 2){ %>
                                            <option name="thanhtoan" selected value="2">Đã Thanh Toán</option>
                                            <option name="thanhtoan"  value="1"> Chưa Thanh Toán</option>
                                            <% } else{ %>  
                                                <option name="thanhtoan"  value="2">Đã Thanh Toán</option>
                                                <option name="thanhtoan" selected value="1"> Chưa Thanh Toán</option>
                                        <% } %>
                                </select>
                            </div>
                        </div>


                        <div class="form-group row">
                            <label class="col-sm-2 col-form-label">Nhà Cung Cấp</label>
                            <div class="col-sm-10">
                                <select class="form-control" name="mancc">
                                    <% for(var i=0; i < nhacungcap.length; i++) { %>
                                        <% if(nhacungcap[i].mancc == phieunhap.mancc){ %>
                                            <option name="mancc" selected value="<%= nhacungcap[i].mancc %>"> <%= nhacungcap[i].tenncc %></option>
                                            <% } else{ %>  
                                                <option value="<%= nhacungcap[i].mancc %>"> <%= nhacungcap[i].tenncc %></option>
                                           <% } %>
                                     <%} %>
                                </select>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-sm-2 col-form-label">Trạng Thái</label>
                            <div class="col-sm-10">
                                <select class="form-control" name="matt">
                                    <% for(var i=0; i < trangthai.length; i++) { %>
                                        <% if(trangthai[i].matt == phieunhap.matt){ %>
                                            <option name="matt" selected value="<%= trangthai[i].matt %>"> <%= trangthai[i].tentt %></option>
                                            <% } else{ %>  
                                                <option value="<%= trangthai[i].matt %>"> <%= trangthai[i].tentt %></option>
                                           <% } %>
                                     <%} %>
                                </select>
                            </div>
                        </div>

                      

                        <div class="form-group row">
                            <div class="col-sm-10 ml-sm-auto">
                                <button class="btn btn-info btn-rounded " type="submit">Cập Nhật</button>
                                <a href="/admin/phieunhap/details/<%= phieunhap.mapn %>" class="btn btn-info btn-rounded">Xem Chi Tiết</a>
                            </div>
                        </div>
                    </form>
                </div>
            </div> 

        </div>

        <div class="col-md-7">
            <% if (typeof status !== 'undefined') { %>
                <%if (status == 'successSP') { %>
                    <div class="ibox ibox-success">
                        <div class="ibox-head">
                            <div class="ibox-title">
                                <div style="color: rgb(255, 255, 255);">
                                    Cập Nhật Thành Công!
                                </div>
                            </div>
                            <div class="ibox-tools">
                                <a class="ibox-collapse"><i class="fa fa-minus"></i></a>
                                <a class="fullscreen-link"><i class="fa fa-expand"></i></a>
                            </div>

                <% } else { %>

                    <%if (status == 'khongxoaduoc') { %>

                    <div class=" ibox ibox-danger">
                        <div class="ibox-head">
                                <div class="ibox-title">
                                       
                                        <div style="color: rgb(255, 255, 255);">
                                            Không được xóa sản phẩm cuối!
                                        </div>
                                </div>
                                <div class="ibox-tools">
                                        <a class="ibox-collapse"><i class="fa fa-minus"></i></a>
                                        <a class="fullscreen-link"><i class="fa fa-expand"></i></a>
                                </div>
                                <% } else { %>
                                    <div class="ibox ibox-info">
                                        <div class="ibox-head">
                                            <div class="ibox-title">
                                                <div style="color: rgb(255, 255, 255);">
                                                Cập Nhật Sản Phẩm Trong Phiếu Nhập
                                                </div>
                                            </div>
                                            <div class="ibox-tools">
                                                <a class="ibox-collapse"><i class="fa fa-minus"></i></a>
                                                <a class="fullscreen-link"><i class="fa fa-expand"></i></a>
                                            </div>
                                <% } %>
                <% } %>
            <% } else { %>
                <div class="ibox ibox-info">
                    <div class="ibox-head">
                        <div class="ibox-title">
                            <div style="color: rgb(255, 255, 255);">
                            Danh Sách Sản Phấm
                            </div>
                        </div>
                        <div class="ibox-tools">
                            <a class="ibox-collapse"><i class="fa fa-minus"></i></a>
                            <a class="fullscreen-link"><i class="fa fa-expand"></i></a>
                        </div>
            <% } %>
                </div>
                <div class="ibox-body">
                  
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Tên Sản Phẩm</th>
                                    <th>Số Lượng Nhập</th>
                                    <th>Giá Tiền Nhập</th>
                                    <th>Hành Động</th>
                                </tr>
                            </thead>
                            <tbody>

                                <% ctpn.forEach((item) => { %>
                                    <% for(var i=0; i< sanpham.length; i++) { %>
                                        <% if(sanpham[i].masp == item.masp){ %>    

                                            <form action="/admin/ctphieunhap/edit/<%= item.mapn %>/<%= item.masp %>" 
                                                class="form-horizontal" 
                                                method="POST"
                                                onSubmit="return confirm('Bạn có chắc chắn muốn đổi?') ">
                                                <input type="hidden" name="_method" value="put" />

                                            <tr>
                                                <td>  <%= sanpham[i].tensp %></td>
                
                                                <td>
                                                    <input class="form-control" type="text" name="soluongnhap"
                                                    value="<%= item.soluongnhap %>">
                                                </td>
                                                </td>
                                                <td>  <input class="form-control number-input" type="text" name="gianhap"
                                                    value="<%= item.gianhap %>" class=""> </td>
                                                <td> 
                                                    <button class="btn btn-default btn-xs" data-toggle="tooltip" data-original-title="Update" type="submit"><i class="fa fa-check font-14"></i></button>

                                                    <a href="/admin/ctphieunhap/delete/<%= item.mapn %>/<%= item.masp %>" onclick="return confirm('Bạn có chắc chăn muốn xóa không?')" class="btn btn-default btn-xs" data-toggle="tooltip" data-original-title="Delete"><i class="fa fa-trash font-14"></i></a>
                                                   
                                                
                      
                                                </td>
                                            </tr>

                                        </form>

                                            <% } %>  
                                            <%} %>
                                    <% }) %>      
                            </tbody>
                        </table>
                      
                       
                      
                  
                </div>
            </div>
        </div>

    </div>

</div>

<div style="height: 150px;"></div>
<!-- Sử dụng cho jquery - validation -->
<script src="/assets/vendors/jquery/dist/jquery.min.js" type="text/javascript"></script>
<script src="/assets/vendors/jquery-validation/dist/jquery.validate.min.js" type="text/javascript"></script>
<script type="text/javascript">
    $("#form-sample-1").validate({
        rules: {
            ghichu: {
                rangelength: [2, 500],
          
            },
            soluongnhap: {
              rangelength: [1, 9],
                number: true,
               required: !0
             },
              gianhap: {
                  required: !0,
                  number: true,
                  rangelength: [1, 11],
              }
        },
        errorClass: "help-block error",
        highlight: function(e) {
            $(e).closest(".form-group.row").addClass("has-error")
        },
        unhighlight: function(e) {
            $(e).closest(".form-group.row").removeClass("has-error")
        },
    });
</script>


<script>
    function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    };

    var status = getUrlParameter('status');

    if (status == 'khongxoaduoc') {
        alert("Không xóa được sản phẩm cuối");
    }


    
    const inputs = document.querySelectorAll('.number-input');

inputs.forEach(input => {
  input.addEventListener('input', function() {
    let value = parseInt(this.value.replace(/\D/g, ''));
    if (value) {
      this.value = value.toLocaleString('en-US');
    }
  });
});

</script>

